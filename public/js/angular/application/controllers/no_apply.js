"use strict";define(["../../services"],function(){return["$rootScope","$scope","$q","$http","$mdDialog",function($rootScope,$scope,$q,$http,$mdDialog){$scope.reset=function(){$scope.columns=[{text:"开发者名称",name:"user_name"},{text:"公司名称",name:"company",style:{width:"320px","text-align":"center"}},{text:"部门名称",name:"department",style:{width:"320px","text-align":"center"}},{text:"添加时间",name:"create_time",style:{width:"160px","text-align":"center"}}],$scope.keyword="",$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.reset(),$scope.searcher=function(index,size){$scope.refreshing=!0;var previous=$scope.tableData&&$scope.tableData._select;return $scope.ajax("list_get",{pageindex:index||$scope.pageIndex,pagesize:size||$scope.pageSize,isv_user_name:$scope.keyword},function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.tableData=data.user_list,$scope.total=data.list_count,$scope.tableData&&$scope.tableData[0]&&(previous?$scope.tableData._select=[].concat.apply([],$scope.tableData.map(function(r){return previous.id==r.id?[r]:[]}))[0]:$scope.tableData._select=$scope.tableData[0])):($rootScope.alert(data.msg),$scope.total=0)},function(){$scope.total=0})["finally"](function(){$scope.refreshing=!1})},$scope.tableData=[],$scope.research=function(){$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.deleteUser=function(){return $rootScope.confirm("请确认是否要删除开发者？",function(){return $scope.ajax("isv_delete",{isv_user_id:$scope.tableData._select&&$scope.tableData._select.id},function(data){("boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success)&&($scope.research(),$rootScope.warn("删除成功",1))})})};var IsvAppenderController=function(scope,user_list){scope.original_user_list=user_list,scope.user_list=scope.original_user_list,scope.keyword="",scope.columns=[{text:"开发者名称",name:"user_name",style:{"text-align":"center",width:"228px"}},{text:"公司名称",name:"company",style:{width:"320px","text-align":"center"}}],scope.multiple=!0,scope.filter=function(){scope.user_list=scope.original_user_list.filter(function(user){return user.user_name.indexOf(scope.keyword)!=-1||user.company.indexOf(scope.keyword)!=-1})},scope.save=function(){if(!scope.refreshing){var list=[].concat.apply([],scope.user_list.map(function(r){return r._checked?[{user_id:r.user_id}]:[]}));return list.length?(scope.refreshing=!0,$http.post("/agent",{module:"application",partial:"noapply",api:"isv_save",param:{user_list:list}}).then(function(body){if("boolean"==typeof body.data.is_success&&body.data.is_success||"string"==typeof body.data.is_success&&"true"==body.data.is_success)return scope.close(),$scope.reset(),body.data},function(why){return scope.error=why,$q.reject(why)})["finally"](function(){scope.refreshing=!1})):void(scope.error="请选择至少一位开发者进行添加")}},scope.close=function(){$mdDialog.hide()}};$scope.appender=function(ev,api){if(!$scope.refreshing)return $scope.refreshing=!0,$scope.ajax("isv_list_get",{isv_user_name:""},function(data){data.user_list&&data.user_list.length?$mdDialog.show({controller:IsvAppenderController,template:'\n              <md-dialog aria-label="添加开发者" class="reminderTwoColumn" aria-describedby="reminder">\n                  <md-toolbar>\n                      <div class="md-toolbar-tools">\n                          <h3><span>添加开发者</span></h3>\n                          <md-button class="md-icon-button md-primary md-hue-1" aria-label="Settings" ng-click="close()">\n                              <md-icon md-svg-icon="content:ic_clear_24px"></md-icon>\n                          </md-button>\n                      </div>\n                  </md-toolbar>\n              \n                  <md-dialog-content>\n                      <div class="md-dialog-content" >\n                          <form class="search-wrapper">\n                              <div class="search-group">\n                                  <button type="submit">\n                                      <md-icon class="md-primary" md-svg-icon="action:ic_search_24px"></md-icon>\n                                  </button>\n                                  <input type="text" class="searcher" ng-model="keyword" ng-change="filter()" placeholder="请输入关键字......" />\n                              </div>\n                          </form>\n                          <div class="table-wrapper">\n                              <rop-fixed-table cols="columns" data="user_list" cursor="index" keyword="keyword" multiple="multiple" />\n                              <div class="app-loading" ng-if="refreshing">\n                                  <md-progress-circular md-mode="indeterminate"></md-progress-circular>\n                              </div>\n                          </div>\n                      </div>\n                  </md-dialog-content>\n                  \n                  <md-dialog-actions layout="row">\n                      <div class="message wideDialog" ng-if="error">\n                          <span ng-bind="error"></span>\n                      </div>\n                    <md-button ng-click="save()">确定</md-button>\n                  </md-dialog-actions>\n              </md-dialog>\n          ',autoWrap:!1,targetEvent:ev,clickOutsideToClose:!0,parent:angular.element(document.querySelector("body>section>md-content")),locals:{user_list:data.user_list}}):$rootScope.alert("尚未有任何开发者")})["finally"](function(){$scope.refreshing=!1})},window.test=$scope}]});