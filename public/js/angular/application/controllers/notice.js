"use strict";define(["../../services"],function(){return["$rootScope","$scope","$http","$stateParams","$location","$mdDialog","$q","ModuleLoader",function($rootScope,$scope,$http,$stateParams,$location,$mdDialog,$q,ModuleLoader){function showContentDialog(ev,notice){notice&&$mdDialog.show({controller:ShowContentCtrl,template:'\n          <md-dialog aria-label="公告信息" class="form notice" aria-describedby="quick edit">\n              <md-toolbar>\n                <div class="md-toolbar-tools">\n                  <md-icon md-svg-icon="navigation:ic_apps_24px"></md-icon>\n                  <h3><span ng-bind="\'公告信息\'"></span></h3>\n                  <md-button class="md-icon-button md-primary md-hue-1" aria-label="Settings" ng-click="close()">\n                    <md-icon md-svg-icon="content:ic_clear_24px"></md-icon>\n                  </md-button>\n                </div>\n              </md-toolbar>\n              <md-dialog-content>\n                <div class="title">\n                  <div class="md-toolbar-tools">\n                      <md-button class="md-fab md-primary md-mini" aria-label="Eat cake">\n                          <md-icon md-svg-icon="av:ic_volume_down_24px"></md-icon>\n                      </md-button>\n                      <h5 flex>\n                          <span>{{notice.notice_title}}</span>\n                      </h5>\n                      <small class="status"><a href="javascript:" class="pr-5">{{notice.create_user_name}}</a> <span class="pr-5">|</span> <i class="fa fa-calendar pr-5"></i>{{notice.create_time}}</small>\n                   </div>\n                 </div>\n                 <div class="content">\n                   <div class="area" ng-bind-html="notice.notice_content  | unescapeHtml | trusthtml"></div>\n</div>\n              </md-dialog-content>\n              <md-dialog-actions layout="row" style="display: none">\n                <div class="message" ng-if="error">\n                  <span ng-bind="error"></span>\n                </div>\n                <md-button ng-click="close()" type="submit">确定</md-button>\n              </md-dialog-actions>\n            </md-dialog>',autoWrap:!1,targetEvent:ev,clickOutsideToClose:!0,parent:angular.element(document.querySelector("body>section>md-content")),locals:{notice:notice}})}$scope.reset=function(){$scope.columns=[{text:"公告名称",name:"notice_title",compile:'<a href="javascript:" ng-click="$parent.$parent.col.showContent($event, $parent.row)">{{$parent.row[$parent.col.name]}}<md-tooltip md-direction="bottom">{{$parent.row[$parent.col.name]}}</md-tooltip></a>',showContent:function(event,notice){$scope.showContent(event,notice)}},{text:"创建者",name:"create_user_name",style:{width:"160px","text-align":"center"}},{text:"添加时间",name:"create_time",style:{width:"160px","text-align":"center"}}],$scope.keyword="",$scope.batch=!1,$scope.pageIndex=1,$scope.pageSize=new Number(10),$scope.mode=0,$scope.notice={notice_id:"",notice_title:"",notice_content:"",notice_flag:"0",is_new:"0",is_top:"0"}},$scope.reset(),$scope.searcher=function(index,size){$scope.refreshing=!0;var previous=$scope.tableData&&$scope.tableData._select;return $scope.ajax("list",{pageindex:index||$scope.pageIndex,pagesize:size||$scope.pageSize,noticet_title:$scope.keyword},function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.tableData=data.data_list,$scope.tableData&&$scope.tableData[0]&&(previous?$scope.tableData._select=[].concat.apply([],$scope.tableData.map(function(r){return previous.notice_id==r.notice_id?[r]:[]}))[0]||$scope.tableData[0]:$scope.tableData._select=$scope.tableData[0]),$scope.total=data.list_count):($rootScope.alert(data.msg),$scope.total=0)},function(){$scope.total=0})["finally"](function(){$scope.refreshing=!1})},$scope.tableData=[],$scope.research=function(){$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.canOperate=function(){return $scope.tableData._select},$scope.save=function(){if(!$scope.refreshing)return $scope.noticeForm.$invalid?void($scope.noticeForm.$error.required&&$scope.noticeForm.$error.required.forEach(function(r){r.$setDirty(!0)})):($scope.refreshing=!0,$scope.ajax("save",{notice_id:$scope.notice.notice_id,notice_title:$scope.notice.notice_title,notice_content:$scope.notice.notice_content,is_top:$scope.notice.is_top?"1":"0"}).then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.mode=0,$scope.notice.notice_id?$scope.searcher():$scope.reset()):$rootScope.alert(data.msg)})["finally"](function(){$scope.refreshing=!1}))},$scope.deleteNotice=function(row){return $rootScope.confirm("请确认是否要删除公告？",function(){return $scope.ajax("delete",{notice_id:$scope.tableData._select.notice_id},function(data){$rootScope.warn("删除成功",1),$scope.research()})})},$scope.options={toolbar:[{name:"clipboard",items:["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"styles",items:["Format","Font","FontSize"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","RemoveFormat","CopyFormatting"]},{name:"colors",items:["TextColor","BGColor"]},{name:"align",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","Outdent","Indent"]},{name:"links",items:["Link","Unlink","Image","Table"]},{name:"document",items:["Source"]}],font_names:"Helvetica Neue;Microsoft YaHei;Arial/Arial, Helvetica, sans-serif;Times New Roman/Times New Roman, Times, serif;Verdana",customConfig:"",disallowedContent:"img{width,height,float}",extraAllowedContent:"img[width,height,align]",height:440,contentsCss:["/vendor/ckeditor/contents.css"],bodyClass:"document-editor",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",stylesSet:[{name:"Marker",element:"span",attributes:{"class":"marker"}},{name:"Cited Work",element:"cite"},{name:"Inline Quotation",element:"q"},{name:"Special Container",element:"div",styles:{padding:"5px 10px",background:"#eee",border:"1px solid #ccc"}},{name:"Compact table",element:"table",attributes:{cellpadding:"5",cellspacing:"0",border:"1",bordercolor:"#ccc"},styles:{"border-collapse":"collapse"}},{name:"Borderless Table",element:"table",styles:{"border-style":"hidden","background-color":"#E6E6FA"}},{name:"Square Bulleted List",element:"ul",styles:{"list-style-type":"square"}}]},$scope.appender=function(ev,notice){if(!$scope.refreshing)return notice?($scope.refreshing=!0,$scope.ajax("detail",{notice_id:notice.notice_id}).then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.notice=data,$scope.notice.is_top="1"==data.is_top,!$scope.notice.notice_id&&($scope.notice.notice_id=notice.notice_id),$scope.mode=1):($rootScope.alert(data.msg),$scope.mode=0)})["finally"](function(){$scope.refreshing=!1})):($scope.notice={notice_id:"",notice_title:"",notice_content:"",notice_flag:"0",is_new:"0",is_top:!1},void($scope.mode=1))},$scope.cancel=function(){$scope.mode=0},$scope.showContent=function(event,notice){showContentDialog(event,notice)};var ShowContentCtrl=function(scope,notice){scope.notice=notice,scope.close=function(){$mdDialog.hide()}};$scope.kickoff=$q.when(),window.test=$scope,$scope.$watch(function(){return $scope.mode},function(mode){mode?$rootScope.globalBack=globalBack:$rootScope.globalBack=null});var globalBack=function(){$scope.refreshing||$scope.cancel()};$scope.$on("$destroy",function(event){$rootScope.globalBack=null})}]});