"use strict";define(["../../services"],function(){return["$rootScope","$scope","$http","$stateParams","$location","$mdDialog","$q","ModuleLoader",function($rootScope,$scope,$http,$stateParams,$location,$mdDialog,$q,ModuleLoader){$scope.reset=function(){$scope.columns=[{text:"文档名称",name:"doc_name",tooltip:!0,linker:{create:function(row){return Constant.protocol+"://"+Constant.host+":"+Constant.port+"/welcome/document/"+row.doc_id},target:"_blank"}},{text:"添加时间",name:"create_time",style:{width:"196px","text-align":"center"}}],$scope.keyword="",$scope.batch=!1,$scope.pageIndex=1,$scope.pageSize=new Number(10),$scope.mode=0,$scope.doc={doc_id:"",doc_name:"",doc_content:""}},$scope.reset(),$scope.searcher=function(index,size){$scope.refreshing=!0;var previous=$scope.tableData&&$scope.tableData._select;return $scope.ajax("list",{pageindex:index||$scope.pageIndex,pagesize:size||$scope.pageSize,doc_name:$scope.keyword},function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.tableData=data.data_list,$scope.tableData&&$scope.tableData[0]&&(previous?$scope.tableData._select=[].concat.apply([],$scope.tableData.map(function(r){return previous.doc_id==r.doc_id?[r]:[]}))[0]:$scope.tableData._select=$scope.tableData[0]),$scope.total=data.list_count):($rootScope.alert(data.msg),$scope.total=0)},function(){$scope.total=0})["finally"](function(){$scope.refreshing=!1})},$scope.tableData=[],$scope.research=function(){$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.canOperate=function(){return $scope.tableData._select},$scope.save=function(){if(!$scope.refreshing)return $scope.docForm.$invalid?void($scope.docForm.$error.required&&$scope.docForm.$error.required.forEach(function(r){r.$setDirty(!0)})):$scope.doc&&$scope.doc.doc_content?($scope.refreshing=!0,$scope.ajax("save",{doc_id:$scope.doc.doc_id,doc_name:$scope.doc.doc_name,doc_content:$scope.doc.doc_content}).then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.mode=0,$scope.doc.doc_id?$scope.searcher():$scope.reset()):$rootScope.alert(data.msg)})["finally"](function(){$scope.refreshing=!1})):void $rootScope.warn("编辑内容不能为空")},$scope.deleteDoc=function(row){return $rootScope.confirm("请确认是否要删除文档？",function(){return $scope.ajax("delete",{doc_id:$scope.tableData._select.doc_id},function(data){$rootScope.warn("删除成功",1),$scope.research()})})},$scope.options={toolbar:[{name:"clipboard",items:["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"styles",items:["Format","Font","FontSize"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","RemoveFormat","CopyFormatting"]},{name:"colors",items:["TextColor","BGColor"]},{name:"align",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","Outdent","Indent"]},{name:"links",items:["Link","Unlink","Image","Table"]},{name:"document",items:["Source"]}],font_names:"Helvetica Neue;Microsoft YaHei;Arial/Arial, Helvetica, sans-serif;Times New Roman/Times New Roman, Times, serif;Verdana",customConfig:"",disallowedContent:"img{width,height,float}",extraAllowedContent:"img[width,height,align]",height:440,contentsCss:["/vendor/ckeditor/contents.css"],bodyClass:"document-editor",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",stylesSet:[{name:"Marker",element:"span",attributes:{"class":"marker"}},{name:"Cited Work",element:"cite"},{name:"Inline Quotation",element:"q"},{name:"Special Container",element:"div",styles:{padding:"5px 10px",background:"#eee",border:"1px solid #ccc"}},{name:"Compact table",element:"table",attributes:{cellpadding:"5",cellspacing:"0",border:"1",bordercolor:"#ccc"},styles:{"border-collapse":"collapse"}},{name:"Borderless Table",element:"table",styles:{"border-style":"hidden","background-color":"#E6E6FA"}},{name:"Square Bulleted List",element:"ul",styles:{"list-style-type":"square"}}]},$scope.appender=function(ev,doc){if(!$scope.refreshing)return doc?($scope.refreshing=!0,$scope.ajax("detail",{doc_id:doc.doc_id}).then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.doc=data.doc_info,!$scope.doc.doc_id&&($scope.doc.doc_id=doc.doc_id),$scope.mode=1):($rootScope.alert(data.msg),$scope.mode=0)})["finally"](function(){$scope.refreshing=!1})):($scope.doc={doc_id:"",doc_name:"",doc_content:""},void($scope.mode=1))},$scope.cancel=function(){$scope.mode=0},$scope.kickoff=$q.when(),window.test=$scope,$scope.$watch(function(){return $scope.mode},function(mode){mode?$rootScope.globalBack=globalBack:$rootScope.globalBack=null});var globalBack=function(){$scope.refreshing||$scope.cancel()};$scope.$on("$destroy",function(event){$rootScope.globalBack=null})}]});