"use strict";define(["../../services"],function(cta){return["$rootScope","$scope","$q","$location","$http","$timeout","$mdDialog","MiscTool","ROPDateUtil",function($rootScope,$scope,$q,$location,$http,$timeout,$mdDialog,MiscTool,ROPDateUtil){$scope.columns=[{text:"发送日期",name:"send_time",formatter:function(str){var result="";try{result=ROPDateUtil.freeFormatDate(new Date(str),"yyyy-MM-dd")}catch(e){}return result},style:{width:"196px","text-align":"center"}},{text:"发送次数",name:"send_count",style:{"text-align":"center"}},{text:"计费次数",name:"billing_num",style:{"text-align":"center"}}],$scope.loading=!0;var initQ=$scope.ajax("init").then(function(data){return $scope.channels=data.channel_list,$scope.signs=data.append_name_list,data})["finally"](function(){$scope.loading=!1});$scope.chooseChannel=function(channel){$scope.selectChannel=channel,$scope.research()},$scope.chooseSign=function(sign){$scope.selectSign=sign,$scope.research()},$scope.reset=function(){$scope.selectChannel=null,$scope.selectSign=null,$scope.now=new Date,$scope.mindate=ROPDateUtil.incrementDays($scope.now,-3),$scope.maxdate=new Date,$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.research=function(){$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.searcher=function(index,size){$scope.refreshing=!0;var previous=$scope.tableData&&$scope.tableData._select;return $scope.tableData=[],initQ.then(function(){return $scope.ajax("list",{pageindex:index||$scope.pageIndex,pagesize:size||$scope.pageSize,channel_id:$scope.selectChannel?$scope.selectChannel.channel_id:"",append_name:$scope.selectSign||"",send_time_begin:ROPDateUtil.freeFormatDate($scope.mindate,"yyyy-MM-dd"),send_time_end:ROPDateUtil.freeFormatDate($scope.maxdate,"yyyy-MM-dd")}).then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.tableData=data.send_list,$scope.tableData&&$scope.tableData[0]&&(previous?$scope.tableData._select=[].concat.apply([],$scope.tableData.map(function(r){return previous.id==r.id?[r]:[]}))[0]:$scope.tableData._select=$scope.tableData[0]),$scope.total=data.list_count):($rootScope.alert(data.msg),$scope.total=0)},function(){$scope.total=0})})["finally"](function(){$scope.refreshing=!1})},$scope.reset(),window.test=$scope}]});