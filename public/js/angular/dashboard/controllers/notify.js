"use strict";define(["../../services"],function(){return["$rootScope","$scope","$q","$http","$mdDialog",function($rootScope,$scope,$q,$http,$mdDialog){function getType(){if(!$scope.loading)return $scope.loading=!0,$rootScope.ajax("notify_type_get").then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.typeList=data.data_list,$scope.typeList._type=data.data_list[0]):$rootScope.alert(data.msg)})["finally"](function(){$scope.loading=!1})}function getDetail(){if(!$scope.refreshing)return $scope.refreshing=!0,getTypeQ.then(function(){return $rootScope.ajax("notify_detail_get",{notify_type_id:$scope.typeList._type&&$scope.typeList._type.notify_type_id}).then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?$scope.notifyInfo=data.notify_info:$rootScope.alert(data.msg)})["finally"](function(){$scope.refreshing=!1})})}var getTypeQ=void 0,getDetailQ=void 0;$scope.reset=function(){$scope.typeList=[],getTypeQ=getType(),getDetailQ=getDetail()},$scope.reset(),$scope.changeType=function(type){$scope.typeList._type=type,getDetailQ=getDetail()},$scope.append=function(type,selector){if("mail"===type)$scope.notifyInfo.mail_list&&$scope.notifyInfo.mail_list.push({mail:""});else if("sms"===type)$scope.notifyInfo.mobile_list&&$scope.notifyInfo.mobile_list.push({mobile:""});else{if("url"!==type)return;$scope.notifyInfo.url_list&&$scope.notifyInfo.url_list.push({url:""})}var $el=angular.element(selector);$el.animate({scrollTop:$el[0].scrollHeight})},$scope.splice=function(type,index){"mail"===type?$scope.notifyInfo.mail_list&&$scope.notifyInfo.mail_list.splice(index,1):"sms"===type?$scope.notifyInfo.mobile_list&&$scope.notifyInfo.mobile_list.splice(index,1):"url"===type&&$scope.notifyInfo.url_list&&$scope.notifyInfo.url_list.splice(index,1)},$scope.save=function(){if(!$scope.refreshing)return $scope.mailForm.$invalid||$scope.smsForm.$invalid||$scope.urlForm.$invalid?($scope.mailForm.$invalid&&($scope.mailForm.$error.required&&$scope.mailForm.$error.required.forEach(function(r){r.$setDirty(!0)}),$scope.mailForm.$error.maxlength&&$scope.mailForm.$error.maxlength.forEach(function(r){r.$setDirty(!0)}),$scope.mailForm.$error.pattern&&$scope.mailForm.$error.pattern.forEach(function(r){r.$setDirty(!0)}),$scope.mailForm.$error.email&&$scope.mailForm.$error.email.forEach(function(r){r.$setDirty(!0)})),$scope.smsForm.$invalid&&($scope.smsForm.$error.required&&$scope.smsForm.$error.required.forEach(function(r){r.$setDirty(!0)}),$scope.smsForm.$error.maxlength&&$scope.smsForm.$error.maxlength.forEach(function(r){r.$setDirty(!0)}),$scope.smsForm.$error.pattern&&$scope.smsForm.$error.pattern.forEach(function(r){r.$setDirty(!0)})),$scope.urlForm.$invalid&&($scope.urlForm.$error.required&&$scope.urlForm.$error.required.forEach(function(r){r.$setDirty(!0)}),$scope.urlForm.$error.maxlength&&$scope.urlForm.$error.maxlength.forEach(function(r){r.$setDirty(!0)}),$scope.urlForm.$error.pattern&&$scope.urlForm.$error.pattern.forEach(function(r){r.$setDirty(!0)})),void $rootScope.warn("保存失败，请检查格式是否正确！")):($scope.refreshing=!0,$rootScope.ajax("notify_detail_save",{notify_type_id:$scope.typeList._type.notify_type_id,mail_flag:$scope.notifyInfo.mail_flag,sms_flag:$scope.notifyInfo.sms_flag,url_flag:$scope.notifyInfo.url_flag,mail_list:$scope.notifyInfo.mail_list,mobile_list:$scope.notifyInfo.mobile_list,url_list:$scope.notifyInfo.url_list}).then(function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?$rootScope.warn("保存成功!",!0):$rootScope.alert(data.msg)})["finally"](function(){$scope.refreshing=!1}))},$scope.injectorLoaded=!0,window.test=$scope,window.$scope=$scope}]});