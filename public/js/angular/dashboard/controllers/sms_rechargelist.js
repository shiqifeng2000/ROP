"use strict";define([],function(cta){return["$rootScope","$scope","$q","$http","$timeout","$mdDialog",function($rootScope,$scope,$q,$http,$timeout,$mdDialog){function showProdDialog(ev,pipeList){$mdDialog.show({controller:CreateProdCtrl,template:'\n          <md-dialog aria-label="充值" class="form" aria-describedby="quick edit">\n              <md-toolbar>\n                <div class="md-toolbar-tools">\n                  <md-icon md-svg-icon="navigation:ic_apps_24px"></md-icon>\n                  <h3><span>充值</span></h3>\n                  <md-button class="md-icon-button md-primary md-hue-1" aria-label="Settings" ng-click="close()">\n                    <md-icon md-svg-icon="content:ic_clear_24px"></md-icon>\n                  </md-button>\n                </div>\n              </md-toolbar>\n              <md-dialog-content>\n                <form class="md-dialog-content" name="chargeForm" ng-submit="save()" autocomplete="off">\n                  <div class="input-container">\n                      <label style="width: 108px;">通道名称</label>\n                      <md-menu class="md-dropdown cool" md-offset="1 50" >\n                          <md-button ng-click="$mdOpenMenu($event)" class="md-raised md-primary md-hue-1" md-theme="dracular" aria-label="data control" ng-disabled="refreshing">\n                              <span ng-bind="currentPipe.channel_name"></span>\n                              <md-icon class="" md-svg-icon="navigation:ic_arrow_drop_down_24px"></md-icon>\n                          </md-button>\n                          <md-menu-content class="md-dropdown-content cool" style="width: 264px">\n                              <md-menu-item ng-repeat="pipe in pipeList track by $index"><md-button ng-click="select(pipe)">{{pipe.channel_name}}</md-button></md-menu-item>\n                          </md-menu-content>\n                      </md-menu>\n                  </div>\n                  <div class="input-container">\n                      <label style="width: 108px;">充值数量</label>\n                      <input type="number" name="group_name" ng-model="prod.recharge_num" max="999999" min="100" ng-pattern="\'[0-9]*\'" required/>\n                  </div>\n                  <md-input-container class="md-block">\n                    <label>备注</label>\n                    <textarea ng-model="prod.remark" md-maxlength="100" rows="3" md-select-on-focus style="overflow: auto"></textarea>\n                  </md-input-container>\n                  <div class="hint" ng-if="!subuser.sub_user_id" aria-hidden="false" style="font-size: 12px;\n                    line-height: 14px;height: 28px;\n                    transition: all .3s cubic-bezier(0.55,0,0.55,0.2);\n                    color: rgba(0,0,0,0.38);">选择短信通道、填写短信的充值数量。管理员审核通过后您可以使用短信通道并查询通道余额。\n                  </div>\n                </form>\n                <div class="app-loading" ng-if="refreshing">\n                  <md-progress-circular md-mode="indeterminate"></md-progress-circular>\n                </div>\n              </md-dialog-content>\n              <md-dialog-actions layout="row">\n                <div class="message" ng-if="error">\n                  <span ng-bind="error"></span>\n                </div>\n                <md-button ng-click="save()" type="submit">保存</md-button>\n              </md-dialog-actions>\n            </md-dialog>',autoWrap:!1,targetEvent:ev,clickOutsideToClose:!0,parent:angular.element(document.querySelector("body>section>md-content")),locals:{pipeList:pipeList}})}function getPipeList(){return $scope.loading=!0,$scope.ajax("charge_init").then(function(data){if("boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success){var pipeList=data.channel_list;pipeList.unshift(defaultPipe),$scope.pipeList=pipeList}})["finally"](function(){$scope.loading=!1})}var pipeQ=void 0;$scope.columns=[{text:"通道名称",name:"channel_name",style:{"text-align":"center"}},{text:"充值条数",name:"recharge_num",style:{"text-align":"center"}},{text:"是否审核",name:"recharge_status",style:{"text-align":"center"}},{text:"添加时间",name:"create_time",style:{"text-align":"center"}},{text:"备注",name:"remark",style:{"text-align":"center",width:"240px"}}];var defaultPipe={channel_id:"",channel_name:"短信全部通道"};$scope.prodList=[],$scope.staList=[{sta_name:"全部状态",recharge_status:""},{sta_name:"已审核",recharge_status:"1"},{sta_name:"未审核",recharge_status:"0"}],$scope.pipeList=[defaultPipe],$scope.reset=function(){$scope.loading=!0,$scope.currentPipe=defaultPipe,$scope.currentSta=$scope.staList[0],$scope.maxdate=new Date,$scope.mindate=new Date((new Date).setFullYear((new Date).getFullYear()-1)),pipeQ=getPipeList(),$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.searcher=function(index,size){return $scope.refreshing=!0,pipeQ.then(function(){var previous=$scope.prodList&&$scope.prodList._select;return $scope.ajax("charge_get",{pageindex:index||$scope.pageIndex,pagesize:size||$scope.pageSize,recharge_status:$scope.currentSta&&$scope.currentSta.recharge_status,create_time_begin:$scope.mindate&&$scope.mindate.getFullYear()+"-"+($scope.mindate.getMonth()+1)+"-"+$scope.mindate.getDate(),create_time_end:$scope.maxdate&&$scope.maxdate.getFullYear()+"-"+($scope.maxdate.getMonth()+1)+"-"+$scope.maxdate.getDate(),channel_id:$scope.currentPipe&&$scope.currentPipe.channel_id},function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.prodList=data.recharge_list,$scope.total=data.list_count,$scope.prodList&&$scope.prodList[0]&&(previous?$scope.prodList._select=[].concat.apply([],$scope.prodList.map(function(r){return previous.recharge_id==r.recharge_id?[r]:[]}))[0]:$scope.prodList._select=$scope.prodList[0])):($rootScope.alert(data.msg),$scope.total=0)},function(){$scope.total=0})["finally"](function(){$scope.refreshing=!1})})},$scope.research=function(){$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.creatProd=function(ev){var pipeList=$scope.pipeList.filter(function(pipe){return""!==pipe.channel_id});showProdDialog(ev,pipeList)},$scope.deleteProd=function(){if(!$scope.refreshing&&$scope.prodList._select)return $rootScope.confirm("确定要删除?",function(){$scope.refreshing=!0,$scope.ajax("charge_del",{recharge_id:$scope.prodList._select&&$scope.prodList._select.recharge_id}).then(function(data){("boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success)&&$scope.research()})["finally"](function(){$scope.refreshing=!1})})},$scope.selectPipe=function(pipe){$scope.currentPipe=pipe,$scope.research()},$scope.selectSta=function(status){$scope.currentSta=status,$scope.research()},$scope.listAPI=function(){$scope.research()};var CreateProdCtrl=function(scope,pipeList){scope.pipeList=pipeList,scope.currentPipe=pipeList[0],scope.prod={recharge_num:100,remark:""},scope.save=function(){return scope.chargeForm.$invalid?(scope.chargeForm.$error.required&&scope.chargeForm.$error.required.forEach(function(r){r.$setDirty(!0)}),scope.chargeForm.$error.maxlength&&scope.chargeForm.$error.maxlength.forEach(function(r){r.$setDirty(!0)}),void(scope.error="请检查输入是否正确")):(scope.refreshing=!0,$http.post("/agent",{module:"dashboard",partial:"smsrechargelist",api:"charge_save",param:{user_name:$rootScope.profile&&$rootScope.profile.login_user_name,channel_id:scope.currentPipe&&scope.currentPipe.channel_id,recharge_num:scope.prod.recharge_num,remark:scope.prod.remark}}).then(function(body){return"boolean"==typeof body.data.is_success&&body.data.is_success||"string"==typeof body.data.is_success&&"true"==body.data.is_success?(scope.close(),$scope.research(),body.data):void(scope.error=body.data.msg)},function(why){return scope.error=why,$q.reject(why)})["finally"](function(){scope.refreshing=!1}))},scope.select=function(pipe){scope.currentPipe=pipe},scope.close=function(){$mdDialog.hide()}};$scope.reset(),window.test=$scope}]});