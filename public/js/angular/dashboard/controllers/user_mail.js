"use strict";define([],function(){return["$rootScope","$scope","$q","$http","$mdDialog",function($rootScope,$scope,$q,$http,$mdDialog){function showDialog(ev,mailData,isNew){$mdDialog.show({controller:UserEmailCtrl,template:'\n          <md-dialog aria-label="isNew?添加邮箱:修改邮箱" class="form" aria-describedby="quick edit">\n              <md-toolbar>\n                <div class="md-toolbar-tools">\n                  <md-icon md-svg-icon="navigation:ic_apps_24px"></md-icon>\n                  <h3><span ng-bind="isNew?\'添加邮箱\':\'修改邮箱\'"></span></h3>\n                  <md-button class="md-icon-button md-primary md-hue-1" aria-label="Settings" ng-click="close()">\n                    <md-icon md-svg-icon="content:ic_clear_24px"></md-icon>\n                  </md-button>\n                </div>\n              </md-toolbar>\n              <md-dialog-content>\n                <form class="md-dialog-content postfix-input" name="mailForm" autocomplete="off">\n                  <div class="input-container">\n                    <label>邮箱地址</label>\n                    <input type="email" name="address" maxlength="200" spellcheck="false" ng-model="mailData.mail_address"  style="text-align: left;"\n                    required/>\n                  </div>\n                  <div class="input-container">\n                    <label>邮件类型</label>\n                    <md-checkbox ng-model="mailData.type1" aria-label="Checkbox 1" class="md-primary" ng-true-value="\'1\'" ng-false-value="\'\'" style="margin: 0 45px 0 25px" >公告</md-checkbox>\n                    <md-checkbox ng-model="mailData.type2" aria-label="Checkbox 2" class="md-primary" ng-true-value="\'2\'" ng-false-value="\'\'" >通知</md-checkbox>\n                  </div>\n                  <md-input-container class="md-block">\n                    <label>备注</label>\n                    <textarea ng-model="mailData.remark" md-maxlength="200" rows="5" md-select-on-focus style="overflow: auto"></textarea>\n                  </md-input-container>\n                </form>\n                <div class="app-loading" ng-if="refreshing">\n                  <md-progress-circular md-mode="indeterminate"></md-progress-circular>\n                </div>\n              </md-dialog-content>\n              <md-dialog-actions layout="row">\n                <div class="message" ng-if="error">\n                  <span ng-bind="error"></span>\n                </div>\n                <md-button ng-click="save()" type="submit">保存</md-button>\n              </md-dialog-actions>\n            </md-dialog>',autoWrap:!1,targetEvent:ev,clickOutsideToClose:!0,parent:angular.element(document.querySelector("body>section>md-content")),locals:{mailData:mailData,isNew:isNew}})}$scope.catList=[{id:"",name:"全部"},{id:"Y",name:"可用"},{id:"N",name:"停用"}],$scope.reset=function(){$scope.columns=[{text:"邮件地址",name:"mail_address"},{text:"是否可用",name:"status",style:{width:"220px","text-align":"center"}},{text:"备注",name:"remark",style:{width:"520px","text-align":"center"}},{text:"添加时间",name:"create_time",style:{width:"160px","text-align":"center"}}],$scope.keyword="",$scope.currentCat=$scope.catList[0],$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.reset(),$scope.searcher=function(index,size){$scope.refreshing=!0;var previous=$scope.tableData&&$scope.tableData._select;return $scope.ajax("list_get",{pageindex:index||$scope.pageIndex,pagesize:size||$scope.pageSize,mail_address:$scope.keyword,use_yn:$scope.currentCat.id},function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.tableData=data.user_list,$scope.total=data.list_count,$scope.tableData&&$scope.tableData[0]&&(previous?$scope.tableData._select=[].concat.apply([],$scope.tableData.map(function(r){return previous.mail_id==r.mail_id?[r]:[]}))[0]:$scope.tableData._select=$scope.tableData[0])):($rootScope.alert(data.msg),$scope.total=0)},function(){$scope.total=0})["finally"](function(){$scope.refreshing=!1})},$scope.research=function(){$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.selectCat=function(cat){$scope.currentCat=cat,$scope.research()},$scope.deleteMail=function(){return $rootScope.confirm("请确认是否要删除该邮箱？",function(){return $scope.ajax("delete_email",{mail_id:$scope.tableData._select&&$scope.tableData._select.mail_id},function(data){("boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success)&&($scope.research(),$rootScope.warn("删除成功",1))})})};var UserEmailCtrl=function(scope,mailData,isNew){scope.mailData=mailData,scope.isNew=isNew,scope.save=function(){if(!scope.refreshing)return scope.mailForm.$invalid?(scope.mailForm.$error.required&&scope.mailForm.$error.required.forEach(function(r){r.$setDirty(!0)}),scope.mailForm.$error.maxlength&&scope.mailForm.$error.maxlength.forEach(function(r){r.$setDirty(!0)}),void(scope.error="请检查输入是否正确")):""===scope.mailData.type1&&""===scope.mailData.type2?void(scope.error="请选择邮件类型"):(scope.refreshing=!0,scope.mailData.mail_type=(""===scope.mailData.type1?" ":scope.mailData.type1+",")+scope.mailData.type2,$http.post("/agent",{module:"application",partial:"mail",api:"put_email",param:{mail_id:scope.isNew?void 0:scope.mailData.mail_id,mail_address:scope.mailData.mail_address,type:scope.mailData.mail_type,remark:scope.mailData.remark}}).then(function(body){return"boolean"==typeof body.data.is_success&&body.data.is_success||"string"==typeof body.data.is_success&&"true"==body.data.is_success?(scope.close(),scope.isNew?$scope.research():$scope.searcher(),body.data):void(scope.error=body.data.msg)},function(why){return scope.error=why,$q.reject(why)})["finally"](function(){scope.refreshing=!1}))},scope.close=function(){$mdDialog.hide()}};$scope.creatMail=function(ev){var mailDetail={mail_address:"",type1:"1",type2:"",remark:""};showDialog(ev,mailDetail,!0)},$scope.editMail=function(ev){if(!$scope.refreshing)return $scope.refreshing=!0,$scope.ajax("detail_get",{mail_id:$scope.tableData._select.mail_id},function(data){data.mail_info?(data.mail_info.mail_type.indexOf("1")!==-1?data.mail_info.type1="1":data.mail_info.type1="",data.mail_info.mail_type.indexOf("2")!==-1?data.mail_info.type2="2":data.mail_info.type2="",showDialog(ev,data.mail_info,!1)):$rootScope.alert("尚未有任何开发者")})["finally"](function(){$scope.refreshing=!1})},window.test=$scope}]});